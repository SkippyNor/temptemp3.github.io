<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>aws autoscaling enable metrics collection for asg | temptemp3.github.io/</title>


<link rel="canonical" href="https://temptemp3.github.io//aws-autoscaling-enable-metrics-collection-for-asg.html" />
<link rel="stylesheet" href="css/w3.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="js/smooth-scroll.polyfills.min.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
<style>
body,h1,h2,h3,h4,h5 {font-family: "Raleway", sans-serif}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-104620931-1', 'auto');
  ga('send', 'pageview');
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-5858453275736089",
    enable_page_level_ads: true
  });
</script>
</head>
<body class="w3-light-grey">
<div class="w3-content" style="max-width:1400px">
<div class"w3-margin-top">
<header class="w3-container w3-center w3-padding-32 w3-margin-top"> 
<h1><b><a style="text-decoration:none;" href="https://temptemp3.github.io/">tempt2<sup>3</sup></a></b></h1>
<p>Welcome to the blog of <span class="w3-tag"><a style="text-decoration:none;" href="https://github.com/temptemp3">temptemp3</a></span></p>
</header>
</div>
<div class="w3-row w3-white">
<div class="w3-col l4 w3-hide-small w3-hide-medium">
<div class="w3-bar w3-large">
<a href="aws-autoscaling-enable-metrics-collection-for-asg.html" class="w3-bar-item w3-button">aws-autoscaling-enable-metrics-collection-for-asg</a>
<a href="search.html" class="w3-bar-item w3-button">search</a>
<a class="w3-bar-item w3-button " href=#preface>preface</a>
<a class="w3-bar-item w3-button " href=#introduction>introduction</a>
<a class="w3-bar-item w3-button " href=#enable_auto_scaling_metrics_collection_shortcut>enable auto scaling metrics collection shortcut</a>
<a class="w3-bar-item w3-button " href=#enable_auto_scaling_metrics_collection_guide>enable auto scaling metrics collection guide</a>
<!--.w3-bar--></div>
<!--.w3-col--></div>
<div class="w3-col l8 s12 w3-white">
<div class="w3-container">
<p>aws cli / autoscaling</p>
<a id="enable_metrics_collection_for_asg"></a>

<h1>enable metrics collection for asg</h1>

<p>You created an auto scaling group through the AWS Management Console. Now the issue is "group metrics collection is not enabled for the following auto scaling groups" and; you would simply like to know how to enable metric collection using the AWS CLI. Here you will a <a href="#enable-metrics-collection">bash function aws-cli wrapper</a> to help automate enabling metrics collection for autoscaling groups in AWS.</p>
</div>
</div>
</div>
<div class="w3-row">
<div class="w3-col-12 w3-white w3-margin-top w3-hide-large">
<div class="w3-bar w3-large">
<a href="aws-autoscaling-enable-metrics-collection-for-asg.html" class="w3-bar-item w3-button">aws-autoscaling-enable-metrics-collection-for-asg</a>
<a href="search.html" class="w3-bar-item w3-button">search</a>
<a class="w3-bar-item w3-button " href=#preface>preface</a>
<a class="w3-bar-item w3-button " href=#introduction>introduction</a>
<a class="w3-bar-item w3-button " href=#enable_auto_scaling_metrics_collection_shortcut>enable auto scaling metrics collection shortcut</a>
<a class="w3-bar-item w3-button " href=#enable_auto_scaling_metrics_collection_guide>enable auto scaling metrics collection guide</a>
<!--.w3-bar--></div>
<!--.w3-col--></div>
<div class="w3-col-12 w3-white w3-margin-top">
<style>
.collapsible {
/*
    background-color: #777;
    color: white;
*/
    cursor: pointer;
    padding: 18px;
/*
    width: 100%;
*/
    border: none;
    text-align: left;
    outline: none;
    font-size: 15px;
}

.active, .collapsible:hover {
    background-color: #555;
}

.content {
    padding: 0 18px;
    display: none;
    overflow: hidden;
    background-color: #f1f1f1;
}
</style>
<div class="w3-card-1 w3-margin-bottom w3-white ">
<a id="preface"></a>
<div class="w3-container">
<h2>Preface</h2>

<p>Today in AWS, <u>enabling metrics collection for an auto scaling group</u> was on my to-do list. 
(28 Jul 2017)</p>

<p>This page dedicated to the task of enabling auto scaling metrics collection using the AWS CLI in <a href="bash/">bash</a> scripts.</p>
<a id="introduction"></a>

<h2>Introduction</h2>

<p>As you may know by know, group metrics collection in AWS is not enabled by default for auto scaling groups. Why? <br />
1) Metrics collection is not free; <br />
2) In most cases, autoscaling metrics collection is not need. However, if you would like to track your autoscaling capacity over time, you need to enable auto scaling metrics collection, which can be done using the aws-cli. At the time of creating this document, there was no place to click in the management console, leaving the aws-cli the only way to enable metrics collection for an auto scaling group.</p>
<a id="enable_auto_scaling_metrics_collection_shortcut"></a>

<h2>Enable auto scaling metrics collection shortcut</h2>

<p>If you are really in a hurry to enable auto scaling metrics collection in AWS that you are currently working on, here is the <a href="#aws-cli-example">aws-cli</a> shortcut you need. </p>
<a id="enable_auto_scaling_metrics_collection_guide"></a>

<h2>Enable auto scaling metrics collection guide</h2>

<p>If you've ever picked up where you left off, in the middle of a test, or are in your free tier period, you will find out or be reminded that metrics collection is not enabled by default. <em>So, what do you do?</em></p>

<!-- write about how to enable auto scaling group metrics collection -->

<p><strong>Why enable auto scaling metrics collection?</strong></p>

<p>Metrics collection is used by scaling policies to achieve autoscaling.</p>

<p>Auto scaling groups are created without enabled metrics by default. Auto scaling group metrics collection may be enabled manually via command line through the aws-cli.</p>

<h2 id="aws-cli">AWS CLI</h2>

<p>You need to update an auto scaling group programmatically. To be specific, metrics collection needs to be enabled for a auto scaling group created using the AWS Management console. Here follows a simple bash aws-cli wrapper function.</p>
<a id="aws_autoscaling_enablemetricscollection"></a>

<h3>aws autoscaling enable-metrics-collection</h3>

<p>Autoscaling groups have a metrics collection setting that can be easily enabled or disabled using the AWS CLI.</p>
<a id="required_options"></a>

<h4>required options</h4>

<p>The following options are required by the 'enable-metrics-collection' command of the 'aws autoscaling' command namespace.</p>
<a id="autoscalinggroupname"></a>

<h5>--auto-scaling-group-name</h5>

<p>The name or ARN of the auto scaling group is required.</p>

<!-- link to arn -->
<a id="granularity"></a>

<h5>--granularity</h5>

<p>Despite the only valid value being "1Minute", granularity is required.</p>

<h4 id="aws-cli-example">example</h4>

<p><a name="enable-metrics-collection"></a></p>
<a id="bash_function"></a>

<h5>bash function</h5>
<a id="awscli_wrapper"></a>

<h6>aws-cli wrapper</h6>

<pre><code>enable-metrics-collection() { { local auto_scaling_group_name ; auto_scaling_group_name="${1}" ; }
 local granularity
 granularity="1Minute"
 aws \
 autoscaling \
 enable-metrics-collection \
 --auto-scaling-group-name "${auto_scaling_group_name}" \
 --granularity "${granularity}"
}
</code></pre>
<a id="usage"></a>

<h5>usage</h5>

<pre><code>_() { 
  declare -f "list-autoscaling-groups" 1>/dev/null || { 
    { echo "'${_}' not yet implemented" 1>&2 ; false ; return ; } 
  } 
  list-autoscaling-groups | while read -r auto_scaling_group_name
  do
   enable-metrics-collection "${auto_scaling_group_name}"
  done
}
</code></pre>
<!--.w3-container--></div>
<!--.w3-card--></div>
<script>
var coll = document.getElementsByClassName("collapsible");
var i;

for (i = 0; i < coll.length; i++) {
    coll[i].addEventListener("click", function() {
        this.classList.toggle("active");
        var content = this.nextElementSibling;
        if (content.style.display === "block") {
            content.style.display = "none";
        } else {
            content.style.display = "block";
        }
    });
}
</script>
<!--.w3-col--></div>
</div>
<div class="w3-col-12 w3-white">
<div class="w3-bar w3-large">
<a href="aws-autoscaling-enable-metrics-collection-for-asg.html" class="w3-bar-item w3-button">aws-autoscaling-enable-metrics-collection-for-asg</a>
<a href="search.html" class="w3-bar-item w3-button">search</a>
<a class="w3-bar-item w3-button " href=#preface>preface</a>
<a class="w3-bar-item w3-button " href=#introduction>introduction</a>
<a class="w3-bar-item w3-button " href=#enable_auto_scaling_metrics_collection_shortcut>enable auto scaling metrics collection shortcut</a>
<a class="w3-bar-item w3-button " href=#enable_auto_scaling_metrics_collection_guide>enable auto scaling metrics collection guide</a>
<!--.w3-bar--></div>
<!--.w3-col--></div>

</div>
<!-- .w3-content --></div>
<footer class="w3-container w3-dark-grey w3-padding-32 w3-margin-top">
<p>&copy; 2019 Nicholas Shellabarger</p>
<!--button class="w3-button w3-black w3-disabled w3-padding-large w3-margin-bottom">Previous</button>
<button class="w3-button w3-black w3-padding-large w3-margin-bottom">Next</button-->
<!--mute in global fields -->
<!--p>Powered by <a href="https://www.w3schools.com/w3css/default.asp" target="_blank" rel="nofollow">w3.css</a></p-->
</footer>
<div class="w3-top w3-bar w3-light-grey w3-large">
  <a href="index.html" class="w3-bar-item w3-button w3-blue"><i class="fa fa-home"></i></a>
  <div class="w3-dropdown-click">
  <a href="#" class="w3-bar-item w3-button"><i class="fa fa-bars"></i></a>
  <div class="w3-dropdown-content w3-bar-block w3-card-4">
      <a href="#" class="w3-bar-item w3-button">Link 1</a>
      <a href="#" class="w3-bar-item w3-button">Link 2</a>
      <a href="#" class="w3-bar-item w3-button">Link 3</a>
    </div>
  </div>
  <a href="./search.html" class="w3-bar-item w3-button"><i class="fa fa-search"></i></a>
  <a href="https://github.com/temptemp3" class="w3-bar-item w3-button"><i class="fa fa-github"></i></a>
  <a href="https://temptemp3.github.io/contact.html" class="w3-bar-item w3-button"><i class="fa fa-envelope"></i></a>
</div>
<script>var scroll = new SmoothScroll('a[href*="#"]');</script>
</body>
</html>
